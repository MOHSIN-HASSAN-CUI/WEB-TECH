<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management - 1GOLF BeGOLF</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .card {
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1055;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="https://themes.muffingroup.com/be/golf/wp-content/uploads/2015/04/golf.png" alt="1GOLF Logo" height="30" class="me-2">
                1GOLF BeGOLF
            </a>
            <div class="navbar-nav">
                <a class="nav-link" href="index.html">Back to Main Site</a>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="display-4 text-center text-success">Golf Products Management</h1>
                <p class="text-center text-muted">Manage your golf product inventory with ease</p>
            </div>
        </div>

        <!-- Toast Container for Notifications -->
        <div class="toast-container"></div>

        <!-- Product Form -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="card-title mb-0" id="form-title">Add New Product</h5>
                    </div>
                    <div class="card-body">
                        <form id="productForm">
                            <input type="hidden" id="productId">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="productName" class="form-label">Product Name *</label>
                                    <input type="text" class="form-control" id="productName" required>
                                    <div class="invalid-feedback">Please enter a product name.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="productPrice" class="form-label">Price ($) *</label>
                                    <input type="number" class="form-control" id="productPrice" step="0.01" min="0" required>
                                    <div class="invalid-feedback">Please enter a valid price.</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="productCategory" class="form-label">Category *</label>
                                    <select class="form-select" id="productCategory" required>
                                        <option value="">Select Category</option>
                                        <option value="Clubs">Golf Clubs</option>
                                        <option value="Balls">Golf Balls</option>
                                        <option value="Accessories">Accessories</option>
                                        <option value="Apparel">Apparel</option>
                                        <option value="Shoes">Shoes</option>
                                        <option value="Electronics">Electronics</option>
                                    </select>
                                    <div class="invalid-feedback">Please select a category.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="productStock" class="form-label">Stock Quantity *</label>
                                    <input type="number" class="form-control" id="productStock" min="0" required>
                                    <div class="invalid-feedback">Please enter stock quantity.</div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="productDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="productDescription" rows="3"></textarea>
                            </div>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-success" id="submit-btn">
                                    <span class="spinner-border spinner-border-sm d-none" id="submit-spinner"></span>
                                    Add Product
                                </button>
                                <button type="button" class="btn btn-secondary d-none" id="cancel-btn">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products List -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Products List</h5>
                        <button class="btn btn-light btn-sm" id="refresh-btn">
                            <span class="spinner-border spinner-border-sm d-none" id="refresh-spinner"></span>
                            Refresh
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Product Name</th>
                                        <th>Category</th>
                                        <th>Price</th>
                                        <th>Stock</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="products-table-body">
                                    <!-- Products will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center" id="loading-indicator">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading products...</p>
                        </div>
                        <div class="text-center d-none" id="no-products">
                            <p class="text-muted">No products found. Add your first product above!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function() {
            const API_BASE_URL = 'https://jsonplaceholder.typicode.com';
            let products = [];
            let editMode = false;

            // Initialize the application
            init();

            function init() {
                loadProducts();
                setupEventListeners();
            }

            function setupEventListeners() {
                // Form submission
                $('#productForm').on('submit', handleFormSubmit);
                
                // Refresh button
                $('#refresh-btn').on('click', loadProducts);
                
                // Cancel button
                $('#cancel-btn').on('click', resetForm);
            }

            function loadProducts() {
                showLoading(true);
                
                $.ajax({
                    url: `${API_BASE_URL}/posts`,
                    method: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        // Transform API data to our product structure
                        products = data.slice(0, 10).map((post, index) => ({
                            id: post.id,
                            name: `Golf ${post.title.split(' ')[0]}`,
                            price: (Math.random() * 500 + 10).toFixed(2),
                            category: ['Clubs', 'Balls', 'Accessories', 'Apparel', 'Shoes'][index % 5],
                            stock: Math.floor(Math.random() * 100),
                            description: post.body
                        }));
                        
                        displayProducts();
                        showLoading(false);
                        showToast('Products loaded successfully!', 'success');
                    },
                    error: function(xhr, status, error) {
                        showLoading(false);
                        showToast('Error loading products: ' + error, 'error');
                    }
                });
            }

            function displayProducts() {
                const tbody = $('#products-table-body');
                const noProducts = $('#no-products');
                
                if (products.length === 0) {
                    tbody.addClass('d-none');
                    noProducts.removeClass('d-none');
                    return;
                }
                
                tbody.removeClass('d-none');
                noProducts.addClass('d-none');
                
                tbody.empty();
                
                products.forEach(product => {
                    const row = `
                        <tr>
                            <td>${product.id}</td>
                            <td>
                                <strong>${product.name}</strong>
                                ${product.description ? `<br><small class="text-muted">${product.description.substring(0, 50)}...</small>` : ''}
                            </td>
                            <td>
                                <span class="badge bg-info">${product.category}</span>
                            </td>
                            <td>$${product.price}</td>
                            <td>
                                <span class="badge ${product.stock > 10 ? 'bg-success' : 'bg-warning'}">
                                    ${product.stock} in stock
                                </span>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary edit-btn" data-id="${product.id}">
                                        Edit
                                    </button>
                                    <button class="btn btn-outline-danger delete-btn" data-id="${product.id}">
                                        Delete
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                    tbody.append(row);
                });
                
                // Add event listeners to action buttons
                $('.edit-btn').on('click', handleEdit);
                $('.delete-btn').on('click', handleDelete);
            }

            function handleFormSubmit(e) {
                e.preventDefault();
                
                if (!validateForm()) {
                    return;
                }
                
                const productData = {
                    name: $('#productName').val(),
                    price: parseFloat($('#productPrice').val()),
                    category: $('#productCategory').val(),
                    stock: parseInt($('#productStock').val()),
                    description: $('#productDescription').val()
                };
                
                if (editMode) {
                    updateProduct(productData);
                } else {
                    createProduct(productData);
                }
            }

            function validateForm() {
                let isValid = true;
                const fields = ['#productName', '#productPrice', '#productCategory', '#productStock'];
                
                fields.forEach(field => {
                    const element = $(field);
                    if (!element.val()) {
                        element.addClass('is-invalid');
                        isValid = false;
                    } else {
                        element.removeClass('is-invalid');
                    element.addClass('is-valid');
                    setTimeout(() => element.removeClass('is-valid'), 2000);
                    }
                });
                
                return isValid;
            }

            function createProduct(productData) {
                showSubmitLoading(true);
                
                // Since JSONPlaceholder doesn't actually create data, we'll simulate it
                $.ajax({
                    url: `${API_BASE_URL}/posts`,
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        title: productData.name,
                        body: productData.description,
                        userId: 1
                    }),
                    success: function(response) {
                        // Add the new product to our local array with the response ID
                        const newProduct = {
                            ...productData,
                            id: response.id
                        };
                        products.unshift(newProduct);
                        
                        displayProducts();
                        resetForm();
                        showSubmitLoading(false);
                        showToast('Product created successfully!', 'success');
                    },
                    error: function(xhr, status, error) {
                        showSubmitLoading(false);
                        showToast('Error creating product: ' + error, 'error');
                    }
                });
            }

            function handleEdit(e) {
                const productId = parseInt($(e.target).data('id'));
                const product = products.find(p => p.id === productId);
                
                if (product) {
                    enterEditMode(product);
                }
            }

            function enterEditMode(product) {
                editMode = true;
                
                // Fill form with product data
                $('#productId').val(product.id);
                $('#productName').val(product.name);
                $('#productPrice').val(product.price);
                $('#productCategory').val(product.category);
                $('#productStock').val(product.stock);
                $('#productDescription').val(product.description);
                
                // Update UI for edit mode
                $('#form-title').text('Edit Product');
                $('#submit-btn').html('<span class="spinner-border spinner-border-sm d-none" id="submit-spinner"></span> Update Product');
                $('#cancel-btn').removeClass('d-none');
                
                // Scroll to form
                $('html, body').animate({
                    scrollTop: $('#productForm').offset().top - 100
                }, 500);
            }

            function updateProduct(productData) {
                showSubmitLoading(true);
                const productId = parseInt($('#productId').val());
                
                $.ajax({
                    url: `${API_BASE_URL}/posts/${productId}`,
                    method: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        id: productId,
                        title: productData.name,
                        body: productData.description,
                        userId: 1
                    }),
                    success: function(response) {
                        // Update product in local array
                        const index = products.findIndex(p => p.id === productId);
                        if (index !== -1) {
                            products[index] = { ...productData, id: productId };
                            displayProducts();
                        }
                        
                        resetForm();
                        showSubmitLoading(false);
                        showToast('Product updated successfully!', 'success');
                    },
                    error: function(xhr, status, error) {
                        showSubmitLoading(false);
                        showToast('Error updating product: ' + error, 'error');
                    }
                });
            }

            function handleDelete(e) {
                const productId = parseInt($(e.target).data('id'));
                const productName = products.find(p => p.id === productId)?.name;
                
                if (confirm(`Are you sure you want to delete "${productName}"?`)) {
                    deleteProduct(productId);
                }
            }

            function deleteProduct(productId) {
                $.ajax({
                    url: `${API_BASE_URL}/posts/${productId}`,
                    method: 'DELETE',
                    success: function() {
                        // Remove product from local array
                        products = products.filter(p => p.id !== productId);
                        displayProducts();
                        showToast('Product deleted successfully!', 'success');
                    },
                    error: function(xhr, status, error) {
                        showToast('Error deleting product: ' + error, 'error');
                    }
                });
            }

            function resetForm() {
                editMode = false;
                $('#productForm')[0].reset();
                $('#productId').val('');
                $('#form-title').text('Add New Product');
                $('#submit-btn').html('<span class="spinner-border spinner-border-sm d-none" id="submit-spinner"></span> Add Product');
                $('#cancel-btn').addClass('d-none');
                
                // Clear validation classes
                $('.is-invalid, .is-valid').removeClass('is-invalid is-valid');
            }

            function showLoading(show) {
                if (show) {
                    $('#loading-indicator').removeClass('d-none');
                    $('#products-table-body').addClass('d-none');
                    $('#refresh-spinner').removeClass('d-none');
                    $('#refresh-btn').addClass('disabled');
                } else {
                    $('#loading-indicator').addClass('d-none');
                    $('#refresh-spinner').addClass('d-none');
                    $('#refresh-btn').removeClass('disabled');
                }
            }

            function showSubmitLoading(show) {
                if (show) {
                    $('#submit-spinner').removeClass('d-none');
                    $('#submit-btn').addClass('disabled');
                } else {
                    $('#submit-spinner').addClass('d-none');
                    $('#submit-btn').removeClass('disabled');
                }
            }

            function showToast(message, type = 'info') {
                const bgClass = type === 'success' ? 'bg-success' : 
                              type === 'error' ? 'bg-danger' : 'bg-info';
                
                const toastId = 'toast-' + Date.now();
                const toastHtml = `
                    <div id="${toastId}" class="toast align-items-center text-white ${bgClass} border-0" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">
                                ${message}
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                `;
                
                $('.toast-container').append(toastHtml);
                const toastElement = document.getElementById(toastId);
                const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
                toast.show();
                
                // Remove toast from DOM after it's hidden
                toastElement.addEventListener('hidden.bs.toast', function() {
                    this.remove();
                });
            }
        });
    </script>
</body>
</html>